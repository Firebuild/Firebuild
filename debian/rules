#!/usr/bin/make -f

# Use GCC 10 instead of earlier versions for better c++20 support
ifeq ($(shell $(CXX) --version | head -n1 | cut -d\  -f4 | xargs dpkg --compare-versions 10 lt || echo buggy-cxx-20),buggy-cxx-20)
export CC = gcc-10
export CXX = g++-10
endif
# Clang does not support -ffat-lto-objects and this breaks check_c_compiler_flag() tests in cmake
ifeq ($(CC),clang)
export DEB_CFLAGS_MAINT_STRIP = -ffat-lto-objects
export DEB_CPPFLAGS_MAINT_STRIP = -ffat-lto-objects
export DEB_CXXFLAGS_MAINT_STRIP = -ffat-lto-objects
export DEB_LDLAGS_MAINT_STRIP = -ffat-lto-objects
endif

%:
	dh $@

override_dh_auto_install:
	dh_auto_install

override_dh_auto_test:
ifeq ($(filter nocheck,$(DEB_BUILD_OPTIONS)),)
	make -C obj-* check
endif
